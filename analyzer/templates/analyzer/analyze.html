<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualizador de Archivos ARFF</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #2b2b2f; padding: 20px; color: #e6e7e8; }
        .table-wrapper { background: linear-gradient(180deg, rgba(58,58,62,0.95), rgba(48,48,52,0.95)); padding:0; border-radius:12px; box-shadow:0 6px 24px rgba(0,0,0,0.5); margin-top:20px; overflow:hidden; border:1px solid rgba(255,255,255,0.04); }
        .data-card-header { padding:14px 20px; display:flex; align-items:center; gap:12px; background:rgba(0,0,0,0.25); }
        .data-card-title { color:#ffffff; font-size:16px; font-weight:600; margin:0; }
        .data-card-body { padding:16px; background: linear-gradient(180deg, rgba(30,30,34,0.6), rgba(25,25,28,0.6)); }
        .table { margin:0; font-size:13px; border-collapse:collapse; width:100%; background:transparent; }
        .table th { background:transparent; border-bottom:1px solid rgba(255,255,255,0.06); font-weight:600; color:rgba(255,255,255,0.95); padding:10px 12px; text-align:left; }
        .table td { border-bottom:1px solid rgba(255,255,255,0.03); color:#111111; padding:10px 12px; vertical-align:middle; }
        .table tbody tr:nth-child(odd) { background: rgba(255,255,255,0.04); }
        .table tbody tr:nth-child(even) { background: rgba(255,255,255,0.06); }
        .data-table-container { overflow-x:auto; }
        .scroll-sync { overflow-x:auto; overflow-y:hidden; height:12px; position:sticky; top:16px; z-index:999; background:transparent; }
        .scroll-sync .sync-bar { height:4px; background:rgba(14,165,164,0.92); border-radius:4px; }
        .upload-form { background:transparent; padding:18px 20px; border-radius:8px; box-shadow:none; margin-bottom:18px; }
        .upload-form .form-label, .upload-form .form-text, .upload-form label { color: rgba(230,230,230,0.9); }
        .upload-form .form-control { background: rgba(255,255,255,0.03); border:1px solid rgba(255,255,255,0.06); color:#ffffff; box-shadow:none; }
        .upload-form .form-control::placeholder { color: rgba(255,255,255,0.6); }
        .upload-form input[type="file"] { background: rgba(255,255,255,0.02); border:1px solid rgba(255,255,255,0.06); color:#fff; width:100%; }
        .upload-form .form-check-label { color: rgba(230,230,230,0.9); }
        .form-check-inline { display:inline-flex; align-items:center; }
        .form-check-label { white-space:nowrap; }
        .panda { font-size:28px; display:inline-block; margin-right:10px; vertical-align:middle; }
        .btn-primary { background-color:#0ea5a4; border-color:#0ea5a4; color:#ffffff !important; }
        .btn-primary:hover, .btn-primary:focus { background-color:#0b8b86; border-color:#0b8b86; color:#ffffff !important; }
        h1 { font-size:24px; font-weight:400; margin-bottom:20px; color:#ffffff; }
    </style>
</head>
<body>
    <div class="container">
    <h1 class="text-center"><span class="panda" role="img" aria-label="panda">üêº</span>PandasArff</h1>
        
        <div class="upload-form">
            <form method="post" enctype="multipart/form-data" novalidate>
                {% csrf_token %}

                <div class="mb-3">
                    <label class="form-label">Selecciona fuente</label>
                    <div>
                        {% for radio in form.source %}
                            <div class="form-check form-check-inline">
                                {{ radio.tag }}
                                <label class="form-check-label ms-1 me-3" for="{{ radio.id_for_label }}">{{ radio.choice_label }}</label>
                            </div>
                        {% endfor %}
                    </div>
                </div>

                <div id="upload-block" class="mb-3 row align-items-center">
                    <div class="col-md-12">
                        <label class="form-label">Subir archivo (.arff)</label>
                        {{ form.arff_file }}
                    </div>
                </div>

                <div id="github-block" class="mb-3" style="display:none;">
                    <label class="form-label">URL del archivo en GitHub</label>
                    {{ form.github_url }}
                </div>

                <div class="d-flex justify-content-end mt-2">
                    <button type="submit" class="btn btn-primary">Visualizar</button>
                </div>
            </form>
        </div>

        {% if error %}
            <div class="alert alert-danger">
                {{ error }}
            </div>
        {% endif %}

        {% if df_html %}
            <div class="table-wrapper">
                <div class="data-card-header">
                    <span class="panda" role="img" aria-label="panda" style="font-size:22px;">üêº</span>
                    <div>
                        <p class="data-card-title">Contenido: {{ file_name }}</p>
                        <small style="color:rgba(255,255,255,0.7);">{{ num_rows }} filas √ó {{ num_cols }} columnas</small>
                    </div>
                </div>

                <div class="data-card-body">
                    <div class="data-table-container">
                        {{ df_html|safe }}
                    </div>
                </div>
            </div>
        {% endif %}
    </div>
    <script>
        function toggleSource() {
            const uploadBlock = document.getElementById('upload-block');
            const githubBlock = document.getElementById('github-block');
            const radios = document.querySelectorAll('input[name="source"]');
            let val = 'upload';
            radios.forEach(r => { if (r.checked) val = r.value; });
            if (val === 'upload') {
                uploadBlock.style.display = '';
                githubBlock.style.display = 'none';
            } else {
                uploadBlock.style.display = 'none';
                githubBlock.style.display = '';
            }
        }
        document.addEventListener('DOMContentLoaded', function(){
            document.querySelectorAll('input[name="source"]')
                .forEach(r => r.addEventListener('change', toggleSource));
            toggleSource();

            const tableContainer = document.querySelector('.data-table-container');
            const topSync = document.createElement('div');
            topSync.className = 'scroll-sync';

            if (tableContainer) {
                const parent = tableContainer.parentNode;
                parent.insertBefore(topSync, tableContainer);

                const updateSync = () => {
                    const table = tableContainer.querySelector('table');
                    topSync.innerHTML = '';
                    if (table) {
                        const inner = document.createElement('div');
                        inner.className = 'sync-bar';
                        inner.style.width = table.scrollWidth + 'px';
                        topSync.appendChild(inner);
                    }
                };

                topSync.addEventListener('scroll', () => { tableContainer.scrollLeft = topSync.scrollLeft; });
                tableContainer.addEventListener('scroll', () => { topSync.scrollLeft = tableContainer.scrollLeft; });
                window.addEventListener('resize', updateSync);
                updateSync();
            }
        });
    </script>
</body>
</html>